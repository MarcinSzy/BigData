{"paragraphs":[{"text":"\nval hc = new org.apache.spark.sql.hive.HiveContext(sc);","user":"anonymous","dateUpdated":"2019-01-31T22:02:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nhc: org.apache.spark.sql.hive.HiveContext = org.apache.spark.sql.hive.HiveContext@4985dcd7\n"}]},"apps":[],"jobName":"paragraph_1548665732176_-1338959696","id":"20190126-194005_1008241861","dateCreated":"2019-01-28T08:55:32+0000","dateStarted":"2019-01-31T22:02:23+0000","dateFinished":"2019-01-31T22:02:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1859"},{"title":"Define DataSets from Hive","text":"import org.apache.spark.sql.DataFrame\n\nval dfArray =  Array.ofDim[DataFrame](9,3);\n\ndfArray(0)(0) = hc.sql(\"select * FROM ODS.BADGESxml\");\ndfArray(0)(1) = hc.sql(\"select * FROM STG.BADGES\");\ndfArray(0)(2) = hc.sql(\"select * FROM SOR.BADGES\");\n\ndfArray(1)(0) = hc.sql(\"select * FROM ODS.COMMENTSxml\");\ndfArray(1)(1) = hc.sql(\"select * FROM STG.COMMENTS\");\ndfArray(1)(2) = hc.sql(\"select * FROM SOR.COMMENTS\");\n\ndfArray(2)(0) = hc.sql(\"select * FROM ODS.POSTSxml\");\ndfArray(2)(1) = hc.sql(\"select * FROM STG.POSTS\");\ndfArray(2)(2) = hc.sql(\"select * FROM SOR.POSTS\");\n\ndfArray(3)(0) = hc.sql(\"select * FROM ODS.POSTHISTORYxml\");\ndfArray(3)(1) = hc.sql(\"select * FROM STG.POSTHISTORY\");\ndfArray(3)(2) = hc.sql(\"select * FROM SOR.POSTHISTORY\");\n\ndfArray(4)(0) = hc.sql(\"select * FROM ODS.POSTLINKSxml\");\ndfArray(4)(1) = hc.sql(\"select * FROM STG.POSTLINKS\");\ndfArray(4)(2) = hc.sql(\"select * FROM SOR.POSTLINKS\");\n\ndfArray(5)(0) = hc.sql(\"select * FROM ODS.USERSxml\");\ndfArray(5)(1) = hc.sql(\"select * FROM STG.USERS\");\ndfArray(5)(2) = hc.sql(\"select * FROM SOR.USERS\");\n\ndfArray(6)(0) = hc.sql(\"select * FROM ODS.TAGSxml\");\ndfArray(6)(1) = hc.sql(\"select * FROM STG.TAGS\");\ndfArray(6)(2) = hc.sql(\"select * FROM SOR.TAGS\");\n\ndfArray(7)(0) = hc.sql(\"select * FROM ODS.VOTESxml\");\ndfArray(7)(1) = hc.sql(\"select * FROM STG.VOTES\");\ndfArray(7)(2) = hc.sql(\"select * FROM SOR.VOTES\");\n\n\n\n","user":"anonymous","dateUpdated":"2019-01-31T22:02:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"},"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.DataFrame\ndfArray: Array[Array[org.apache.spark.sql.DataFrame]] = Array(Array(null, null, null), Array(null, null, null), Array(null, null, null), Array(null, null, null), Array(null, null, null), Array(null, null, null), Array(null, null, null), Array(null, null, null), Array(null, null, null))\n"}]},"apps":[],"jobName":"paragraph_1548665732177_-1339344445","id":"20190126-204306_1982934000","dateCreated":"2019-01-28T08:55:32+0000","dateStarted":"2019-01-31T22:02:24+0000","dateFinished":"2019-01-31T22:02:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1860"},{"title":"Define Needen DataFrames and View with Posts","text":"   val PostsDF = dfArray(2)(2)\n   PostsDF.createOrReplaceTempView(\"PostsDF\")\n","user":"anonymous","dateUpdated":"2019-01-31T22:06:59+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"PostsDF: org.apache.spark.sql.DataFrame = [id: int, posttypeid: tinyint ... 21 more fields]\n"}]},"apps":[],"jobName":"paragraph_1548665759892_1158273559","id":"20190128-085559_496568085","dateCreated":"2019-01-28T08:55:59+0000","dateStarted":"2019-01-31T22:06:59+0000","dateFinished":"2019-01-31T22:07:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1861"},{"title":"Define DataFrame that aggregate number of releted posts ","text":" val PostLinkDF = dfArray(4)(2)\n\nval LinkedPostTargetsDF = PostLinkDF.groupBy(col(\"postid\") , col(\"forumname\")).agg(count(\"relatedpostid\").alias(\"numberOfLinkedPosts\")).sort(col(\"numberOfLinkedPosts\").desc)\n\nLinkedPostTargetsDF.createOrReplaceTempView(\"LinkedPostTargetsDF\")\n\nval LinkedPostsSourceDF = PostLinkDF.groupBy(col(\"relatedpostid\").alias(\"postid\") , col(\"forumname\") ).agg(count(\"postid\").alias(\"numberOfPostsToWhichIsLinked\")).sort(col(\"numberOfPostsToWhichIsLinked\").desc)\n\nLinkedPostsSourceDF.createOrReplaceTempView(\"LinkedPostsSourceDF\")\n","user":"anonymous","dateUpdated":"2019-01-31T22:04:05+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"PostLinkDF: org.apache.spark.sql.DataFrame = [id: int, creationdate: date ... 6 more fields]\nLinkedPostTargetsDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [postid: int, forumname: string ... 1 more field]\nLinkedPostsSourceDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [postid: int, forumname: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1548707758410_-2015487440","id":"20190128-203558_402812435","dateCreated":"2019-01-28T20:35:58+0000","dateStarted":"2019-01-31T22:04:05+0000","dateFinished":"2019-01-31T22:04:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1862"},{"text":"LinkedPostsSourceDF.filter(col(\"PostId\").equalTo(21618)).show()","user":"anonymous","dateUpdated":"2019-01-28T21:30:40+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+---------+----------------------------+\n|postid|forumname|numberOfPostsToWhichIsLinked|\n+------+---------+----------------------------+\n| 21618|    anime|                         455|\n+------+---------+----------------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1548710978796_-1596671032","id":"20190128-212938_1431314642","dateCreated":"2019-01-28T21:29:38+0000","dateStarted":"2019-01-28T21:30:40+0000","dateFinished":"2019-01-28T21:30:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1863"},{"title":"Creadte joined table with data to  calculate statistic ","text":"  val  KYCDoorStep =   spark.sql ( \n    \"select \" + \n    \"df1.*, df2.creationDate as answerCreationDate, df2.owneruserid as answeringUserId, df3.numberOfLinkedPosts , df4.numberOfPostsToWhichIsLinked \" +\n    \" from PostsDF  df1 left join PostsDF  df2 on ( df1.forumname = df2.forumname and df1.acceptedanswerid = df2.id  )\" +\n    \" left join LinkedPostTargetsDF df3 on (df1.id = df3.postid and df1.forumname=df3.forumname) \" + \n    \" left join LinkedPostsSourceDF df4 on (df1.id = df4.postid and df1.forumname=df4.forumname) \" + \n    \" where df1.posttypeid ='1' \")\n    \n    \n    \n    ","user":"anonymous","dateUpdated":"2019-01-31T22:07:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"KYCDoorStep: org.apache.spark.sql.DataFrame = [id: int, posttypeid: tinyint ... 25 more fields]\n"}]},"apps":[],"jobName":"paragraph_1548699843429_-1543790901","id":"20190128-182403_298699710","dateCreated":"2019-01-28T18:24:03+0000","dateStarted":"2019-01-31T22:07:04+0000","dateFinished":"2019-01-31T22:07:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1864"},{"text":"KYCDoorStep.select(col(\"id\"),col(\"numberOfPostsToWhichIsLinked\")).sort(col(\"numberOfPostsToWhichIsLinked\").desc).show(100)","user":"anonymous","dateUpdated":"2019-01-31T23:55:49+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----+----------------------------+\n|   id|numberOfPostsToWhichIsLinked|\n+-----+----------------------------+\n|21618|                         455|\n|12832|                          23|\n|   55|                          18|\n| 4175|                          15|\n| 3408|                          15|\n|   69|                          14|\n|14890|                          14|\n|  116|                          12|\n|  213|                          12|\n| 3127|                          12|\n|  907|                          11|\n| 7337|                          10|\n| 4696|                          10|\n| 6198|                          10|\n| 4695|                          10|\n|  206|                           9|\n| 2922|                           9|\n| 4748|                           9|\n| 3010|                           9|\n| 3018|                           9|\n| 7292|                           9|\n|12977|                           8|\n|  676|                           8|\n| 7415|                           8|\n| 2872|                           7|\n| 4615|                           7|\n|  422|                           7|\n| 4940|                           7|\n|   39|                           7|\n| 7620|                           7|\n|27638|                           6|\n|48672|                           6|\n|  724|                           6|\n| 7977|                           6|\n| 2145|                           6|\n| 4257|                           6|\n|18391|                           6|\n|14081|                           6|\n|  931|                           6|\n| 5041|                           6|\n|13620|                           6|\n| 4751|                           6|\n|  553|                           6|\n|44943|                           6|\n| 3744|                           5|\n|  894|                           5|\n| 4550|                           5|\n| 4354|                           5|\n| 2979|                           5|\n|  835|                           5|\n|16689|                           5|\n| 3314|                           5|\n| 2178|                           5|\n| 2886|                           5|\n|15124|                           5|\n|  237|                           5|\n|16737|                           5|\n| 2642|                           5|\n| 2597|                           5|\n|  304|                           5|\n| 2351|                           5|\n|11446|                           5|\n| 4284|                           5|\n|26011|                           4|\n|13301|                           4|\n| 4727|                           4|\n| 9709|                           4|\n|34097|                           4|\n| 3515|                           4|\n| 5650|                           4|\n| 2852|                           4|\n|18801|                           4|\n| 6250|                           4|\n| 4245|                           4|\n| 2089|                           4|\n|20657|                           4|\n|41108|                           4|\n|23321|                           4|\n| 8155|                           4|\n|22012|                           4|\n|  664|                           4|\n|19637|                           4|\n|14910|                           4|\n|28885|                           4|\n| 5193|                           4|\n|14429|                           4|\n|20465|                           4|\n| 7539|                           4|\n| 3410|                           4|\n|  846|                           4|\n|10063|                           4|\n| 4484|                           4|\n|40922|                           4|\n| 2470|                           4|\n|34468|                           4|\n|32253|                           4|\n|48095|                           4|\n| 7678|                           4|\n|18642|                           4|\n|20151|                           4|\n+-----+----------------------------+\nonly showing top 100 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548978323674_594395573","id":"20190131-234523_1617995890","dateCreated":"2019-01-31T23:45:23+0000","dateStarted":"2019-01-31T23:55:49+0000","dateFinished":"2019-01-31T23:56:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1865"},{"title":"Analysis of question asked on forum","text":" // analiza zadanych pytań na forum \n val KYContent = KYCDoorStep.select (\n     col(\"Id\"),\n     col(\"OwnerUserId\"),\n     col(\"forumname\"),\n     col(\"posttypeid\"),\n     col(\"creationdate\"),\n     datediff( to_date(col(\"closeddate\")) , col(\"creationdate\")).alias(\"daysToBeClose\"),\n     to_date(col(\"closeddate\")).alias(\"closeddate\") ,\n     col(\"answerCreationDate\"),\n     datediff( to_date(col(\"answerCreationDate\")) , col(\"creationdate\")).alias(\"daysToBeAnswered\"),\n     col(\"answeringUserId\"),\n     when ( (col(\"acceptedanswerid\").isNotNull) , lit(1)).otherwise(0).alias(\"isAnswered\") ,\n     when ( (col(\"closeddate\").isNotNull) , lit(1)).otherwise(0).alias(\"isClosed\")  ,\n     col(\"answercount\"),\n     col(\"commentcount\"),\n     col(\"favoriteCount\"),\n     col(\"numberOfLinkedPosts\"),\n     col(\"numberOfPostsToWhichIsLinked\")\n     ).cache() \n  \n     ","user":"anonymous","dateUpdated":"2019-01-31T22:07:09+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"KYContent: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [Id: int, OwnerUserId: int ... 15 more fields]\n"}]},"apps":[],"jobName":"paragraph_1548697350877_676475697","id":"20190128-174230_913828744","dateCreated":"2019-01-28T17:42:30+0000","dateStarted":"2019-01-31T22:07:09+0000","dateFinished":"2019-01-31T22:07:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1866"},{"title":"What is answer coverage on forum and avg time of accepted answer answer","text":"KYContent.groupBy(\"forumName\").agg( count(\"Id\"), sum(\"isAnswered\"), (sum(\"isAnswered\")/ count(\"Id\")).alias(\"answerCoverage\"), mean(\"daysToBeAnswered\") ).show() ","user":"anonymous","dateUpdated":"2019-01-31T22:07:25+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+---------+---------------+------------------+---------------------+\n|forumName|count(Id)|sum(isAnswered)|    answerCoverage|avg(daysToBeAnswered)|\n+---------+---------+---------------+------------------+---------------------+\n|    anime|     9971|           5380|0.5395647377394444|   32.384200743494425|\n|   arabic|      122|             72|0.5901639344262295|                0.625|\n+---------+---------+---------------+------------------+---------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1548665732178_-1338190198","id":"20190127-235203_1575994224","dateCreated":"2019-01-28T08:55:32+0000","dateStarted":"2019-01-31T22:07:25+0000","dateFinished":"2019-01-31T22:07:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1867"},{"text":"windowSpec = Window .partitionBy(col(\"forumname\"))\r\n    \r\n  \r\n  \r\n  KYContent.KYContent.groupBy(\"forumName\").agg( count(\"Id\"), sum(\"isAnswered\"), (sum(\"isAnswered\")/ count(\"Id\")).alias(\"answerCoverage\"), mean(\"daysToBeAnswered\") ).show() \r\n\r\n\r\nrevenue_difference = \\\r\n  (func.max(dataFrame['revenue']).over(windowSpec) - dataFrame['revenue'])\r\ndataFrame.select(\r\n  dataFrame['product'],\r\n  dataFrame['category'],\r\n  dataFrame['revenue'],\r\n  revenue_difference.alias(\"revenue_difference\"))","user":"anonymous","dateUpdated":"2019-01-31T22:37:22+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548973867716_1313532903","id":"20190131-223107_1676348308","dateCreated":"2019-01-31T22:31:07+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1868"},{"text":"KYContent.filter(col(\"forumName\").equalTo(\"anime\")).groupBy(\"OwnerUserId\").agg(count(col(\"Id\")).alias(\"numOfCreatedPost\")).sort(col(\"numOfCreatedPost\").desc)\n.groupBy(\"numOfCreatedPost\").agg(count(\"OwnerUserId\").alias(\"UsersAct\")).sort(col(\"UsersAct\").desc).show()","user":"anonymous","dateUpdated":"2019-02-01T21:24:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+--------+\n|numOfCreatedPost|UsersAct|\n+----------------+--------+\n|               1|    2409|\n|               2|     339|\n|               3|     125|\n|               4|      69|\n|               5|      39|\n|               6|      35|\n|               7|      28|\n|               8|      23|\n|              10|      14|\n|              14|      13|\n|               9|       9|\n|              12|       8|\n|              11|       8|\n|              17|       6|\n|              16|       6|\n|              15|       6|\n|              19|       6|\n|              13|       4|\n|              21|       4|\n|              18|       4|\n+----------------+--------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548972973688_-1398329695","id":"20190131-221613_1117050750","dateCreated":"2019-01-31T22:16:13+0000","dateStarted":"2019-02-01T21:24:27+0000","dateFinished":"2019-02-01T21:24:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1869"},{"title":"LiveCycle of Post ","text":"val  KYCDoorStep =   spark.sql ( \n    \"select \" + \n    \"df1.*, df2.creationDate as answerCreationDate, df2.owneruserid as answeringUserId, df3.numberOfLinkedPosts , df4.numberOfPostsToWhichIsLinked \" +\n    \" from PostsDF  df1 left join PostsDF  df2 on ( df1.forumname = df2.forumname and df1.acceptedanswerid = df2.id  )\" +\n    \" left join LinkedPostTargetsDF df3 on (df1.id = df3.postid and df1.forumname=df3.forumname) \" + \n    \" left join LinkedPostsSourceDF df4 on (df1.id = df4.postid and df1.forumname=df4.forumname) \" + \n    \" where df1.posttypeid ='1' \")","user":"anonymous","dateUpdated":"2019-01-28T22:27:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548712510708_-1465496848","id":"20190128-215510_903764138","dateCreated":"2019-01-28T21:55:10+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1870"},{"title":"WhenPostsAreCreated","text":"// PostsDF.select( hour (col(\"creationts\")).alias(\"creationHour\") ).groupBy(\"creationHour\").agg(count(\"creationHour\").alias(\"cnt\")).sort(col(\"cnt\").desc)\n\nval PostsDF3 =  PostsDF.select( dayofyear (col(\"creationdate\")).alias(\"creationDay\") ).groupBy(\"creationDay\").agg(count(\"creationDay\").alias(\"cnt\")).sort(col(\"cnt\").desc)","user":"anonymous","dateUpdated":"2019-01-31T23:07:00+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"PostsDF3: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [creationDay: int, cnt: bigint]\n"}]},"apps":[],"jobName":"paragraph_1548714824820_1403853703","id":"20190128-223344_1983557420","dateCreated":"2019-01-28T22:33:44+0000","dateStarted":"2019-01-31T23:07:01+0000","dateFinished":"2019-01-31T23:07:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1871"},{"text":"PostsDF3.write.csv(\"/home/DW/csv/2\")\r\n  ","user":"anonymous","dateUpdated":"2019-01-31T23:07:15+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548715074954_1082171330","id":"20190128-223754_1747071267","dateCreated":"2019-01-28T22:37:54+0000","dateStarted":"2019-01-31T23:07:15+0000","dateFinished":"2019-01-31T23:07:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1872"},{"text":"dfArray(2)(2)","user":"anonymous","dateUpdated":"2019-02-01T21:29:32+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548975429404_718917420","id":"20190131-225709_913445238","dateCreated":"2019-01-31T22:57:09+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1873"}],"name":"KnowYourContent","id":"2E3ANVM5A","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}